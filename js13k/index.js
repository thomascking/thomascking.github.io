(()=>{"use strict";const t=33,e=37,s=41,a=44,n=49,r=[[t,.25],[t,.25],[n,.25],[n,.25],[55,.25],[55,.25],[n,.5],[a,.25],[a,.25],[s,.25],[s,.25],[e,.25],[e,.25],[t,.5],[n,.25],[n,.25],[a,.25],[a,.25],[s,.25],[s,.25],[e,.5],[n,.25],[n,.25],[a,.25],[a,.25],[s,.25],[s,.25],[e,.5],[t,.25],[t,.25],[n,.25],[n,.25],[55,.25],[55,.25],[n,.5],[a,.25],[a,.25],[s,.25],[s,.25],[e,.25],[e,.25],[t,.5]],i=(t,e,s)=>t.setAttribute(e,s),o=t=>document.createElementNS("http://www.w3.org/2000/svg",t);class c{x;y;size;density;graphic;vX=0;vY=0;mass;volume;constructor(t,e,s,a){this.x=t,this.y=e,this.size=s,this.density=a,this.volume=s*s*s*4*Math.PI/3,this.mass=this.volume*a;const n=`#f${Math.min(15,Math.floor(64*(a-.5))).toString(16)}${Math.max(0,Math.floor(63*(a-.75))).toString(16)}`,r=o("circle");i(r,"fill",n),i(r,"r","50"),i(r,"filter","url(#blurMe)"),i(r,"transform",`scale(${s})`),this.graphic=o("g"),i(this.graphic,"transform",`translate(${t} ${e})`),this.graphic.appendChild(r)}addLight(){}appendTo(t){t.appendChild(this.graphic)}removeFrom(t){t.removeChild(this.graphic)}render(){i(this.graphic,"transform",`translate(${this.x} ${this.y})`)}}let h=0,l=0,f=500,u=500,m=0,p=0,x=0,d=0,g=!1,M=!1,y=0,v=!1;const w=t=>document.getElementById(t),C=w("left"),b=w("right"),A=w("backStart"),S=w("backOff");let k;(async()=>{const t=new OfflineAudioContext(1,529200,44100),e=t.createGain(),s=t.createOscillator();s.connect(e),e.connect(t.destination),e.gain.setValueAtTime(.1,0),s.type="triangle";let a=0;return s.frequency.setValueAtTime(0,0),r.forEach((([t,e])=>((t,e)=>{s.frequency.setTargetAtTime(t,a,.1*e),s.frequency.setTargetAtTime(0,a+.8*e,.1*e),a+=e})(t,e))),s.start(0),await t.startRendering()})().then((t=>k=t));const $=new class{musicCtx;musicGain;sfxVol=.25;sfxMap={};ctxMap={};constructor(){}initialize(){this.musicCtx=new AudioContext}playMusic(t){this.musicGain=this.musicCtx.createGain();const e=this.musicCtx.createBufferSource();e.buffer=t,e.loop=!0,e.connect(this.musicGain),this.musicGain.connect(this.musicCtx.destination),e.start(0)}registerBuffer(t,e){this.sfxMap[t]=e}playSfx(t,e,s,a=0,n=1){if(this.ctxMap[t])return;const r=new AudioContext,i=r.createGain();i.gain.value=n;const o=r.createBufferSource();if(o.buffer=this.sfxMap[e],o.loop=s,0!==a){const t=r.createStereoPanner();t.pan.value=a,o.connect(t),t.connect(i)}else o.connect(i);i.connect(r.destination),o.start(0),this.ctxMap[t]={ctx:r,gain:i}}stopSfx(t){this.ctxMap[t]&&(this.ctxMap[t].ctx.close(),delete this.ctxMap[t])}stopAll(){for(let t in this.ctxMap)this.stopSfx(t)}};(async()=>{const t=new OfflineAudioContext(1,44100,44100),e=t.createBuffer(1,44100,44100),s=e.getChannelData(0);for(let t=0;t<44100;t++)s[t]=.1*Math.random()-.05;const a=t.createBufferSource();return a.buffer=e,a.connect(t.destination),a.start(),await t.startRendering()})().then((t=>$.registerBuffer("thrust",t))),window.onkeydown=t=>{if(y)switch(t.key){case"Enter":break;case" ":x||(x=1,A.beginElement(),$.playSfx("back","thrust",!0));break;case"ArrowLeft":g||(d-=1,g=!0,i(b,"specularConstant","1"),$.playSfx("right","thrust",!0,1,.25));break;case"ArrowRight":M||(d+=1,M=!0,i(C,"specularConstant","1"),$.playSfx("left","thrust",!0,-1,.25))}else"Enter"===t.key&&(v||I(),L())},window.onkeyup=t=>{if(y)switch(t.key){case" ":x&&(x=0,S.beginElement(),$.stopSfx("back"));break;case"ArrowLeft":g&&(d+=1,g=!1,i(b,"specularConstant",".01"),$.stopSfx("right")),l=0;break;case"ArrowRight":M&&(d-=1,M=!1,i(C,"specularConstant",".01"),$.stopSfx("left")),l=0}};const E=w("stars"),T=w("ship"),X=w("lightTrans"),Y=w("lightTrans2"),q=w("spedometer");w("lastLight");const B=[],G=(t,e,s,a)=>{const n=new c(t,e,s,a);return n.appendTo(E),B.push(n),n};let z;const F=()=>{y=requestAnimationFrame(F);let t=performance.now(),e=t-z;z=t;let s=h*Math.PI/180;m-=.00625*m,p-=.00625*p;const a=[];if(B.forEach(((t,s)=>{const n=f-t.x,r=u-t.y,i=Math.sqrt(n*n+r*r);i<50*t.size+15&&O();const o=Math.atan2(n,r),c=t.mass/(i*i);p+=c*e*Math.cos(o),m+=c*e*Math.sin(o),t.vX-=.00625*t.vX,t.vY-=.00625*t.vY,B.forEach(((n,r)=>{if(s===r)return;const i=t.x-n.x,o=t.y-n.y,c=Math.sqrt(i*i+o*o);if(c<50*n.size)return void a.push([s,r]);const h=Math.atan2(i,o),l=10*n.mass/(c*c);t.vY+=l*e*Math.cos(h),t.vX+=l*e*Math.sin(h)})),t.x+=-t.vX*e,t.y+=-t.vY*e,t.render()})),a.length>0){const[t,e]=a.pop(),s=B[t],n=B[e],r=(s.x+n.x)/2,i=(s.y+n.y)/2,o=s.mass+n.mass,c=s.volume+n.volume,h=o/c,l=Math.pow(3*c/(4*Math.PI),.333),f=G(r,i,l,h);f.vX=(s.vX*s.mass+n.vX*n.mass)/f.mass,f.vY=(s.vY*s.mass+n.vY*n.mass)/f.mass,B.splice(t,1),B.splice(e,1),s.removeFrom(E),n.removeFrom(E)}p+=275e-6*x*e*Math.cos(s),m+=275e-6*x*e*-Math.sin(s);let n=Math.sqrt(m*m+p*p);f+=-m*e,u+=-p*e,l+=.001*d*e,l>.5&&(l=.5),l<-.5&&(l=-.5),h+=l*e,i(E,"transform",`translate(${500-f} ${500-u})`),i(T,"transform",`rotate(${h})`),q.innerHTML=`${Math.round(100*n)}`,i(X,"dx",`${f}`),i(X,"dy",`${u}`),i(Y,"dx",""+-f),i(Y,"dy",""+-u)},L=()=>{f=500,u=500,m=0,p=0,l=0,h=0,x=0,d=0,g=!1,M=!1,B.forEach((t=>{t.removeFrom(E)})),B.length=0,G(0,0,1.5,.5),G(1e3,200,.75,.75),G(500,900,.5,1),z=performance.now(),F()},I=()=>{v=!0,$.initialize(),$.playMusic(k)},O=()=>{cancelAnimationFrame(y),y=0,S.beginElement(),i(b,"specularConstant",".01"),i(C,"specularConstant",".01"),$.stopAll()}})();