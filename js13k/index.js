(()=>{"use strict";const t=33,e=37,n=41,a=44,s=49,r=[[t,.25],[t,.25],[s,.25],[s,.25],[55,.25],[55,.25],[s,.5],[a,.25],[a,.25],[n,.25],[n,.25],[e,.25],[e,.25],[t,.5],[s,.25],[s,.25],[a,.25],[a,.25],[n,.25],[n,.25],[e,.5],[s,.25],[s,.25],[a,.25],[a,.25],[n,.25],[n,.25],[e,.5],[t,.25],[t,.25],[s,.25],[s,.25],[55,.25],[55,.25],[s,.5],[a,.25],[a,.25],[n,.25],[n,.25],[e,.25],[e,.25],[t,.5]];let i=0,c=0,o=500,l=500,f=0,u=0,h=0,p=0,x=!1,g=!1,m=0,d=!1;const M=t=>document.getElementById(t),y=M("left"),w=M("right"),C=M("backStart"),S=M("backOff");let k;(async()=>{const t=new OfflineAudioContext(1,529200,44100),e=t.createGain(),n=t.createOscillator();n.connect(e),e.connect(t.destination),e.gain.setValueAtTime(.1,0),n.type="triangle";let a=0;return n.frequency.setValueAtTime(0,0),r.forEach((([t,e])=>((t,e)=>{n.frequency.setTargetAtTime(t,a,.1*e),n.frequency.setTargetAtTime(0,a+.8*e,.1*e),a+=e})(t,e))),n.start(0),await t.startRendering()})().then((t=>k=t));const b=new class{musicCtx;musicGain;sfxVol=.25;sfxMap={};ctxMap={};constructor(){}initialize(){this.musicCtx=new AudioContext}playMusic(t){this.musicGain=this.musicCtx.createGain();const e=this.musicCtx.createBufferSource();e.buffer=t,e.loop=!0,e.connect(this.musicGain),this.musicGain.connect(this.musicCtx.destination),e.start(0)}registerBuffer(t,e){this.sfxMap[t]=e}playSfx(t,e,n,a=0,s=1){if(this.ctxMap[t])return;const r=new AudioContext,i=r.createGain();i.gain.value=s;const c=r.createBufferSource();if(c.buffer=this.sfxMap[e],c.loop=n,0!==a){const t=r.createStereoPanner();t.pan.value=a,c.connect(t),t.connect(i)}else c.connect(i);i.connect(r.destination),c.start(0),this.ctxMap[t]={ctx:r,gain:i}}stopSfx(t){this.ctxMap[t]&&(this.ctxMap[t].ctx.close(),delete this.ctxMap[t])}stopAll(){for(let t in this.ctxMap)this.stopSfx(t)}};(async()=>{const t=new OfflineAudioContext(1,44100,44100),e=t.createBuffer(1,44100,44100),n=e.getChannelData(0);for(let t=0;t<44100;t++)n[t]=.1*Math.random()-.05;const a=t.createBufferSource();return a.buffer=e,a.connect(t.destination),a.start(),await t.startRendering()})().then((t=>b.registerBuffer("thrust",t))),window.onkeydown=t=>{if(m)switch(t.key){case"Enter":break;case" ":h||(h=1,C.beginElement(),b.playSfx("back","thrust",!0));break;case"ArrowLeft":x||(p-=1,x=!0,z(w,"specularConstant","1"),b.playSfx("right","thrust",!0,1,.25));break;case"ArrowRight":g||(p+=1,g=!0,z(y,"specularConstant","1"),b.playSfx("left","thrust",!0,-1,.25))}else"Enter"===t.key&&(d||V(),P())},window.onkeyup=t=>{if(m)switch(t.key){case" ":h&&(h=0,S.beginElement(),b.stopSfx("back"));break;case"ArrowLeft":x&&(p+=1,x=!1,z(w,"specularConstant",".01"),b.stopSfx("right")),c=0;break;case"ArrowRight":g&&(p-=1,g=!1,z(y,"specularConstant",".01"),b.stopSfx("left")),c=0}};const A=M("stars"),$=M("ship"),E=M("lightTrans"),T=M("lightTrans2"),B=M("spedometer");let G=M("lastLight");const q=[],z=(t,e,n)=>t.setAttribute(e,n),L=t=>document.createElementNS("http://www.w3.org/2000/svg",t),O=(t,e,n,a)=>{const s=`#f${Math.min(15,Math.floor(64*(a-.5))).toString(16)}${Math.max(0,Math.floor(63*(a-.75))).toString(16)}`,r=L("circle");z(r,"fill",s),z(r,"transform",`translate(${t} ${e}) scale(${n})`),z(r,"r","50"),z(r,"filter","url(#blurMe)"),A.appendChild(r);const i=`light${q.length}`,c=`out${q.length}`,o=L("feSpecularLighting");z(o,"in","translated"),z(o,"specularExponent","20"),z(o,"specularConstant","5"),z(o,"surfaceScale","15"),z(o,"lighting-color",s);const l=L("fePointLight");z(l,"x",`${t}`),z(l,"y",`${e}`),z(l,"z","200"),o.appendChild(l);const f=L("feComposite");z(f,"in",c),z(f,"in2",i),z(f,"operator","arithmetic"),z(f,"k1","0"),z(f,"k2","1"),z(f,"k3","1"),z(f,"k4","0"),z(G,"result",c),G.after(o,f),G=f,q.push({x:t,y:e,size:n,density:a})};let R;O(0,0,1.5,.5),O(1e3,200,.75,.75),O(500,900,.5,1);const v=()=>{m=requestAnimationFrame(v);let t=performance.now(),e=t-R;R=t;let n=i*Math.PI/180;f-=.00625*f,u-=.00625*u;for(let t of q){const n=o-t.x,a=l-t.y,s=Math.sqrt(n*n+a*a);s<50*t.size+15&&F();const r=Math.atan2(n,a),i=30*t.size*t.density/(s*s);u+=i*e*Math.cos(r),f+=i*e*Math.sin(r)}u+=275e-6*h*e*Math.cos(n),f+=275e-6*h*e*-Math.sin(n);let a=Math.sqrt(f*f+u*u);o+=-f*e,l+=-u*e,c+=.001*p*e,c>.5&&(c=.5),c<-.5&&(c=-.5),i+=c*e,z(A,"transform",`translate(${500-o} ${500-l})`),z($,"transform",`rotate(${i})`),B.innerHTML=`${Math.round(100*a)}`,z(E,"dx",`${o}`),z(E,"dy",`${l}`),z(T,"dx",""+-o),z(T,"dy",""+-l)},P=()=>{o=500,l=500,f=0,u=0,c=0,i=0,h=0,p=0,R=performance.now(),v()},V=()=>{d=!0,b.initialize(),b.playMusic(k)},F=()=>{cancelAnimationFrame(m),m=0,S.beginElement(),z(w,"specularConstant",".01"),z(y,"specularConstant",".01"),b.stopAll()}})();